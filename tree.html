<html>
	<head>
	<link href="style.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="jquery-1.7.1.min.js"></script>
	<script type="text/javascript" src="splitter.js"></script>
	<script type="text/javascript" src="jstree/jquery.jstree.js"></script>
	<script type="text/javascript" src="S3BucketLister.js"></script>
	<script type="text/javascript" src="jquery.s3dirtree.js"></script>
	<script type="text/javascript" src="FileUtils.js"></script>
	<script type="text/javascript" src="S3ThumbnailGenerator.js"></script>
	<script type="text/javascript" src="ImageResizer.js"></script>
	<script type="text/javascript" src="S3Uploader.js"></script>
	<script type="text/javascript" src="AsyncQueue.js"></script>
	<script type="text/javascript" src="Settings.js"></script>
		<script type="text/javascript">
			jQuery(function($) {
				var basePath = '';
                var queryString = window.location.search.substring(0);
                if (queryString.length>0 && queryString.charAt(0)=='?') {
                        queryString.substring(1).split('&').forEach(function(val) {
                                var kvp = val.split('=');
                                if (kvp[0]==='path') {
                                        basePath = kvp[1]; 
                                }
                        });
                }
			
				var thumbnailWidth=128, thumbnailHeight=128;
				
				var thumbnailGenerator = djiaak.S3ThumbnailGenerator(thumbnailWidth, thumbnailHeight, djiaak.settings.thumbnailPath);
				var uploader = djiaak.S3Uploader(djiaak.settings.s3);
				
				
				$('#browser').s3dirtree({
					dirLoadFunction: djiaak.S3BucketLister('https://dj-public.s3.amazonaws.com').listFilesDirs,
					basePath: basePath,
					thumbnailWidth: thumbnailWidth,
					thumbnailHeight: thumbnailHeight,
					fileExtensions: [ '.gif', '.jpg', '.jpeg', '.png' ],
					itemSelected: function($item) {
						$('#img').attr('src', '')
							.attr('src', $item.data('url'));
					},
					isThumbnailFunction: thumbnailGenerator.isThumbnail,
					dirToThumbnailFunction: thumbnailGenerator.dirToThumbnailDir,
					imageToThumbnailFunction: thumbnailGenerator.filenameToThumbnail,
					generateThumbnailFunc: thumbnailGenerator.generateThumbnailAsync,
					fileUploadFunc: uploader.upload
				});
				$("#main").splitter({
					type: 'v',
					sizeLeft: 300,
					dock: 'leftDock',
					dockSpeed: 200
				});
				var resize = function() {
				$('.prev-image').css('left', 
					$('#image').position().left + 'px');
				};
				resize();
				$('#image').resize(function() {
					resize();
				});
				$('.next-image').click(function() {
					$('#browser').s3dirtree('nextImage');
				});
				$('.prev-image').click(function() {
					$('#browser').s3dirtree('prevImage');
				});
				$('.control').mouseover(function() {
					$('.control').fadeTo(100,1.0);
				}).mouseout(function() {
					$('.control').fadeTo(100,0.1);
				});
				
				$(document).keydown(function(e) {
					if (e.which===37) {
						$('#browser').s3dirtree('prevImage');
					} else if (e.which===39) {
						$('#browser').s3dirtree('nextImage');
					}
				});
			});
			
		</script>
	</head>
	<body>
		<div id="main">
			<div id="browser" class="browser"></div>
			<div id="image">
				<img id="img" />
				<div class='control next-image'>&gt;</div>
				<div class='control prev-image'>&lt;</div>
			</div>
		</div>
	</body>
</html>
